




<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Angular provides a mechanism to avoid name collisions in provider tokens. In this article we're going to explore how opaque tokens make this possible.">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="thoughtram">
    <title>How to prevent name collisions in Angular providers by thoughtram</title>
    <meta name="google-site-verification" content="o9eGPEgIETEqYGombq7NiQuBIB_qa6gz1yAL7PxKyK0">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#4D8799">
    <link rel="icon" sizes="192x192" href="/images/touch/chrome-touch-icon-192x192.png">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="thoughtram">
    <link rel="apple-touch-icon" href="/images/touch/apple-touch-icon.png">

    <!-- Tile icon for Win8 (144x144 + tile color) -->
    <meta name="msapplication-TileImage" content="/images/touch/ms-touch-icon-144x144-precomposed.png">
    <meta name="msapplication-TileColor" content="#4D8799">

    <meta property="og:locale" content="en_US">
    <meta property="og:type" content="article">
    <meta property="og:title" content="How to prevent name collisions in Angular providers">
    <meta property="og:description" content="Angular provides a mechanism to avoid name collisions in provider tokens. In this article we're going to explore how opaque tokens make this possible.">
    <meta property="og:url" content="http://blog.thoughtram.io/angular/2016/05/23/opaque-tokens-in-angular-2.html">
    <meta property="og:site_name" content="Articles by thoughtram">
    <meta property="og:image" content="http://blog.thoughtram.io/images/banner/opaque-tokens-in-angular-2.jpeg">
    <meta property="og:publisher" content="http://www.facebook.com/thoughtram">

    <meta property="twitter:card" content="summary">
    <meta property="twitter:title" content="How to prevent name collisions in Angular providers">
    <meta property="twitter:site" content="thoughtram Blog">

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="/css/main.css" type="text/css">
  </head>
  <body class="sub-site">
    <!-- Add your site or app content here -->

    <!--[if lt IE 10]>
        <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->

    <header class="thtrm-header" role="banner">
      <div class="thtrm-header-bar">
        <div class="thtrm-constraint">
          <a href="http://thoughtram.io" class="thtrm-header-logo-link" title="thoughtram.io Start Page"><h1 class="thtrm-header-logo">thoughtram</h1></a>
          <div class="thtrm-header-menu-wrapper">
            <span role="button" tabindex="0" class="thtrm-header-menu-label">Menu</span>
            <ul class="thtrm-header-menu">
              <li><a title="Training" class="thtrm-header-menu-item" href="http://thoughtram.io/training.html">Training</a></li>
              <li><a title="Code Review" class="thtrm-header-menu-item" href="http://thoughtram.io/code-review.html">Code Review</a></li>
              <li><a title="Casts" class="thtrm-header-menu-item " href="http://casts.thoughtram.io">Casts</a></li>
              <li><a title="Blog" class="thtrm-header-menu-item" href="/">Blog</a></li>
            </ul>
          </div>
        </div>
      </div>
    </header>

    <main role="main" class="thtrm-main">
    <div class="thtrm-banner" style="background-image: linear-gradient(to bottom, rgba(0,0,0,0) 0%,rgba(0,0,0,0.01) 2%,#29383E 100%), url('/images/banner/opaque-tokens-in-angular-2.jpeg');">
        <hgroup class="thtrm-banner-container">
          <div class="thtrm-constraint thtrm-constraint--slim">
            <h2 class="thtrm-banner-text">How to prevent name collisions in Angular providers</h2>
            <span>by <a href="http://twitter.com/" title="Pascal Precht on Twitter">Pascal Precht</a> on May 23, 2016, last updated on Mar 3, 2017<br>11 minute read</span>

          </div>
        </hgroup>
      </div>
      <div class="thtrm-constraint thtrm-constraint--slim">

        <section class="thtrm-ad thtrm-section thtrm-section--is-promo is-sticky">
  <img width="100" src="/images/angular2-shield-inverse.svg">
  <h3 class="thtrm-section-headline">Angular Master Class in Las Palmas</h3>
  <p class="thtrm-section-text">Join our upcoming public training!</p>
  <a href="https://www.codecamps.com/aiff4/" title="Angular Master Class in Las Palmas" id="event-cta" class="thtrm-layout-divider-cta">Get a ticket <strong>&rarr;</strong></a>
</section>

        <div class="thtrm-article">

          <p>If you’ve read our article series on everything dependency injection in Angular, you’ve probably realized that Angular is doing a pretty good job on that. We can either use string or type tokens to make dependencies available to the injector. However, when using string tokens, there’s a possibility of running into naming collisions because… well, maybe someone else has used the same token for a different provider. In this article, we’re going to learn how so-called “opaque tokens” solve this problem.</p>

<p><strong>UPDATE</strong>: Since Angular version 4.x <code>OpaqueToken</code> is considered deprecated in favour of <code>InjectionToken</code>. Learn about the differences <a href="#injectiontoken-since-angular-4x">here</a>.</p>

<p style="text-align: center; margin-bottom: -1em;"><strong>Want to see things in action first?</strong></p>

<p class="thtrm-ctas">

  

  
    <a href="#videos" class="thtrm-cta thtrm-cta--small"><i class="material-icons">play_arrow</i> Play videos</a>
  

</p>

<div class="thtrm-toc is-sticky">
  <h3 class="no_toc" id="table-of-contents">TABLE OF CONTENTS</h3>
<ul id="markdown-toc">
  <li><a href="#string-tokens-vs-type-tokens" id="markdown-toc-string-tokens-vs-type-tokens">String Tokens vs Type Tokens</a></li>
  <li><a href="#the-problem-with-string-tokens" id="markdown-toc-the-problem-with-string-tokens">The problem with string tokens</a></li>
  <li><a href="#opaque-tokens-to-the-rescue" id="markdown-toc-opaque-tokens-to-the-rescue">Opaque Tokens to the rescue</a></li>
  <li><a href="#why-it-works" id="markdown-toc-why-it-works">Why it works</a></li>
  <li><a href="#injectiontoken-since-angular-4x" id="markdown-toc-injectiontoken-since-angular-4x">InjectionToken since Angular 4.x</a></li>
  <li><a href="#conclusion" id="markdown-toc-conclusion">Conclusion</a></li>
</ul>

</div>

<p>Before we jump into the actual problem we want to solve, let’s first recap the differences between a string token and a type token.</p>

<h2 id="string-tokens-vs-type-tokens">String Tokens vs Type Tokens</h2>

<p>Angular DI injects singleton instances which are created by provider-registered factories. And it is these instances that are injected at runtime. In order to configure your application DI and associate a factory with a token, we have to setup providers. A couple weeks ago we blogged how <a href="/angular/2016/05/13/angular-2-providers-using-map-literals.html">providers can be created using Map literals</a>, if you haven’t read this one yet we recommend to check it out, as this article pretty much builds up on that one.</p>

<p>The bottom line is that a provider token can be either a string or a type. Depending on our use case, we want to use one or the other. For example, if we have a <code>DataService</code> class, and all we want to do is inject an instance of that class when we ask for a dependency of that type, we would use <code>DataService</code> as a provider token like this:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="err">@</span><span class="nx">Component</span><span class="p">({</span>
  <span class="na">selector</span><span class="p">:</span> <span class="s1">'my-component'</span><span class="p">,</span>
  <span class="na">providers</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span><span class="na">provide</span><span class="p">:</span> <span class="nx">DataService</span><span class="p">,</span> <span class="na">useClass</span><span class="p">:</span> <span class="nx">DataService</span><span class="p">}</span>
  <span class="p">]</span>
<span class="p">})</span>
<span class="kr">class</span> <span class="nx">MyComponent</span> <span class="p">{</span>

  <span class="nx">constructor</span><span class="p">(</span><span class="kr">private</span> <span class="nx">dataService</span><span class="err">:</span> <span class="nx">DataService</span><span class="p">)</span> <span class="p">{}</span>
<span class="p">}</span></code></pre></div>

<p>Since the token matches the dependency instance-type and the provider strategy is <code>useClass</code>, we can also use the <strong>shorthand</strong> version, as:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">providers</span><span class="err">:</span> <span class="p">[</span><span class="nx">DataService</span><span class="p">]</span></code></pre></div>

<p>Angular has many shorthand versions (DI, annotations, etc); and the above code is just one example of those.</p>

<p>Now this is cool, as long as we have classes (or types) to represent the things we want to work with. However, sometimes we need to create other objects that don’t necessarily need to be put in a class representation. We could, for example, have a configuration object that we want to inject into our application. This configuration object can be a simple object literal where there is no type involved.</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">CONFIG</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">apiUrl</span><span class="p">:</span> <span class="s1">'http://my.api.com'</span><span class="p">,</span>
  <span class="na">theme</span><span class="p">:</span> <span class="s1">'suicid-squad'</span><span class="p">,</span>
  <span class="na">title</span><span class="p">:</span> <span class="s1">'My awesome app'</span>
<span class="p">};</span></code></pre></div>

<p>Or maybe, we have a primitive value we want to make injectable, like a string or a boolean value.</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">FEATURE_ENABLED</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></code></pre></div>

<p>In these cases, we can’t use the <code>String</code> or <code>Boolean</code> type, as this would set a default value for the place where we ask for dependencies of these types. And we really don’t want to introduce a new type just to represent these values.</p>

<p>That’s where string tokens come into play. They allow us to make objects available via DI without introducing an actual type:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kd">let</span> <span class="nx">featureEnabledToken</span> <span class="o">=</span> <span class="s1">'featureEnabled'</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">configToken</span> <span class="o">=</span> <span class="s1">'config'</span><span class="p">;</span>

<span class="p">...</span>
<span class="nl">providers</span><span class="p">:</span> <span class="p">[</span>
  <span class="p">{</span> <span class="na">provide</span><span class="p">:</span> <span class="nx">featureEnabledToken</span><span class="p">,</span> <span class="na">useValue</span><span class="p">:</span> <span class="nx">FEATURE_ENABLED</span> <span class="p">},</span>
  <span class="p">{</span> <span class="na">provide</span><span class="p">:</span> <span class="nx">configToken</span><span class="p">,</span> <span class="na">useValue</span><span class="p">:</span> <span class="nx">CONFIG</span> <span class="p">}</span>
<span class="p">]</span></code></pre></div>

<p>Basically all we do is, instead of using a type, we use a simple string as a token. We can inject this dependency using the <code>@Inject()</code> decorator likes this:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Inject</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'@angular/core'</span><span class="p">;</span>

<span class="kr">class</span> <span class="nx">MyComponent</span> <span class="p">{</span>

  <span class="nx">constructor</span><span class="p">(</span>
    <span class="err">@</span><span class="nx">Inject</span><span class="p">(</span><span class="nx">featureEnabledToken</span><span class="p">)</span> <span class="kr">private</span> <span class="nx">featureEnabled</span><span class="p">,</span>
    <span class="err">@</span><span class="nx">Inject</span><span class="p">(</span><span class="nx">configToken</span><span class="p">)</span> <span class="kr">private</span> <span class="nx">config</span>
  <span class="p">)</span> <span class="p">{...}</span>
<span class="p">}</span></code></pre></div>

<p>Note: that above we used <code>@Inject(featureEnabledToken) private featureEnabled</code> without any typing information; e.g. <code>private featureEnabled:boolean</code>.</p>

<p>Okay awesome, we can use strings and types as tokens to inject dependencies in our application. Unfortunately, using string tokens like this opens up potential risks for naming collisions.</p>

<h2 id="the-problem-with-string-tokens">The problem with string tokens</h2>

<p>Let’s get back to our <code>config</code> string token for a second. “config” is a pretty general name, so we probably could’ve done better naming this thing in the first place. However, even if we come up with a more distinguishable name, it is easily possible that someone else will use the same string as a token. Providers are flattened, meaning that, if there are multiple providers with the same token, the last one wins.</p>

<p>And there is another concept that allows us to define multiple providers for the same token. Those are multi providers, and we’ve written about them <a href="/angular2/2015/11/23/multi-providers-in-angular-2.html">here</a>.</p>

<p>Let’s say we use some sort of third-party library that comes with a set of providers defined like this:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">export</span> <span class="kr">const</span> <span class="nx">THIRD_PARTY_LIB_PROVIDERS</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span> <span class="na">provide</span><span class="p">:</span> <span class="s1">'config'</span><span class="p">,</span> <span class="na">useClass</span><span class="p">:</span> <span class="nx">ThirdParyConfig</span> <span class="p">}</span>
<span class="p">];</span></code></pre></div>

<p>Even though it’s not a common pattern to use a string token with a class, it’s totally possible to do that, but we really just want to demonstrate the problem here. We can import and use these third-party providers like this:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="nx">THIRD_PARTY_LIB_PROVIDERS</span> <span class="nx">from</span> <span class="s1">'./third-party-lib'</span><span class="p">;</span>

<span class="p">...</span>
<span class="nx">providers</span> <span class="o">=</span> <span class="p">[</span>
  <span class="nx">DataService</span><span class="p">,</span>
  <span class="nx">THIRD_PARTY_LIB_PROVIDERS</span>
<span class="p">]</span></code></pre></div>

<p>Okay, so far so good. Very often, we don’t really know what’s defined behind other library providers unless we check out the documentation or the source code. Let’s assume we also don’t know this time, that there’s a string token for <code>config</code>, and we try to add our own provider like this:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="p">...</span>
<span class="nx">providers</span> <span class="o">=</span> <span class="p">[</span>
  <span class="nx">DataService</span><span class="p">,</span>
  <span class="nx">THIRD_PARTY_LIB_PROVIDERS</span><span class="p">,</span>
  <span class="p">{</span> <span class="na">provide</span><span class="p">:</span> <span class="nx">configToken</span><span class="p">,</span> <span class="na">useValue</span><span class="p">:</span> <span class="nx">CONFIG</span> <span class="p">}</span>
<span class="p">]</span></code></pre></div>

<p>This will pretty much break our third-party library, because now, the thing that gets injected for the <code>config</code> string token is a different object than what the library expects. We basically ran into a naming collision.</p>

<h2 id="opaque-tokens-to-the-rescue">Opaque Tokens to the rescue</h2>

<p>Luckily, Angular anticipated such scenarios. It comes with a type called <code>OpaqueToken</code> that basically allows us to create string-based tokens without running into any collisions.</p>

<p>Creating an <code>OpaqueToken</code> is easy. All we need to do is to import and use it. Here’s what the third-party providers collection looks like using <code>OpaqueToken</code>:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="p">{</span> <span class="nx">OpaqueToken</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'@angular/core'</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">CONFIG_TOKEN</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OpaqueToken</span><span class="p">(</span><span class="s1">'config'</span><span class="p">);</span>

<span class="kr">export</span> <span class="kr">const</span> <span class="nx">THIRDPARTYLIBPROVIDERS</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">{</span> <span class="na">provide</span><span class="p">:</span> <span class="nx">CONFIG_TOKEN</span><span class="p">,</span> <span class="na">useClass</span><span class="p">:</span> <span class="nx">ThirdPartyConfig</span> <span class="p">}</span>
<span class="p">];</span></code></pre></div>

<p>Of course, this is an implementation detail and we usually shouldn’t have to care about what APIs are used inside a third-party library. Let’s assume we’ve created an <code>OpaqueToken</code> for our config token as well.</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="p">{</span> <span class="nx">OpaqueToken</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'@angular/core'</span><span class="p">;</span>
<span class="kr">import</span> <span class="nx">THIRDPARTYLIBPROVIDERS</span> <span class="nx">from</span> <span class="s1">'./third-party-lib'</span><span class="p">;</span>

<span class="kr">const</span> <span class="nx">MY_CONFIG_TOKEN</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OpaqueToken</span><span class="p">(</span><span class="s1">'config'</span><span class="p">);</span>

<span class="p">...</span>
<span class="nx">providers</span> <span class="o">=</span> <span class="p">[</span>
  <span class="nx">DataService</span><span class="p">,</span>
  <span class="nx">THIRDPARTYLIBPROVIDERS</span><span class="p">,</span>
  <span class="p">{</span> <span class="na">provide</span><span class="p">:</span> <span class="nx">MY_CONFIG_TOKEN</span><span class="p">,</span> <span class="na">useValue</span><span class="p">:</span> <span class="nx">CONFIG</span> <span class="p">}</span>
<span class="p">]</span></code></pre></div>

<p>Running this code will show us that, even though our application seems to use the exact same string token for different providers, Angular’s DI is still smart enough to figure out which dependency we’re interested in. As if we’d have two <em>different</em> tokens. And technically, this is exactly what happens.</p>

<h2 id="why-it-works">Why it works</h2>

<p>If we take a look at the implementation of <code>OpaqueToken</code> we’ll realize that it’s just a simple class with only a <code>.toString()</code> method.</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">export</span> <span class="kr">class</span> <span class="nx">OpaqueToken</span> <span class="p">{</span>

  <span class="nx">constructor</span><span class="p">(</span><span class="kr">private</span> <span class="nx">_desc</span><span class="err">:</span> <span class="nx">string</span><span class="p">)</span> <span class="p">{}</span>

  <span class="nx">toString</span><span class="p">()</span><span class="err">:</span> <span class="nx">string</span> <span class="p">{</span> <span class="k">return</span> <span class="err">`</span><span class="nx">Token</span> <span class="nx">$</span><span class="p">{</span><span class="k">this</span><span class="p">.</span><span class="nx">_desc</span><span class="p">}</span><span class="err">`</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p><code>toString()</code> gets called when an error is thrown in case we’re asking for a dependency that doesn’t have a provider. All it does is add a tiny bit more information to the error message.</p>

<p>However, the secret sauce is, that we’re creating actual object instances of <code>OpaqueToken</code> as opposed to simple string primitives. That’s why Angular’s DI is able to distinguish between our opaque tokens, even though they are based on the same string, because these instances are never the same.</p>

<p>We can easily double-check the equality of two opaque tokens like this:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">TOKEN_A</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OpaqueToken</span><span class="p">(</span><span class="s1">'token'</span><span class="p">);</span>
<span class="kr">const</span> <span class="nx">TOKEN_B</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OpaqueToken</span><span class="p">(</span><span class="s1">'token'</span><span class="p">);</span>

<span class="nx">TOKEN_A</span> <span class="o">===</span> <span class="nx">TOKEN_B</span> <span class="c1">// false</span></code></pre></div>

<h2 id="injectiontoken-since-angular-4x">InjectionToken since Angular 4.x</h2>

<p>Since Angular version 4.x there’s a new, even a little bit better, way of achieving this. <code>InjectionToken</code> does pretty much the same thing as <code>OpaqueToken</code> (in fact, it derives from it). However, it allows to attach type info on the token via TypeScript generics, plus, it adds a little bit of sugar that makes the developer’s life a bit more pleasant when creating factory providers that come with their own dependencies.</p>

<p>Let’s take a look at the following provider configuration for <code>DataService</code>:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">API_URL</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">OpaqueToken</span><span class="p">(</span><span class="s1">'apiUrl'</span><span class="p">);</span>


<span class="nl">providers</span><span class="p">:</span> <span class="p">[</span>
  <span class="p">{</span>
    <span class="na">provide</span><span class="p">:</span> <span class="nx">DataService</span><span class="p">,</span>
    <span class="na">useFactory</span><span class="p">:</span> <span class="p">(</span><span class="nx">http</span><span class="p">,</span> <span class="nx">apiUrl</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="c1">// create data service</span>
    <span class="p">},</span>
    <span class="na">deps</span><span class="p">:</span> <span class="p">[</span>
      <span class="nx">Http</span><span class="p">,</span>
      <span class="k">new</span> <span class="nx">Inject</span><span class="p">(</span><span class="nx">API_URL</span><span class="p">)</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">]</span></code></pre></div>

<p>We’re using a factory function that will create a <code>DataService</code> instance using <code>http</code> and <code>apiUrl</code>. To ensure Angular knows what <code>http</code> and <code>apiUrl</code> are, we add the corresponding DI token to the provider configuration’s <code>deps</code> property. Notice how we can just add the <code>Http</code> token. However, <code>apiUrl</code> is providing using an <code>OpaqueToken</code>, and since it since a type, we have to use the <code>Inject()</code> constructor (equivalent of <code>@Inject()</code> inside constructors).</p>

<p>While this works perfectly fine, developers often ran into errors when they forgot to call <code>new Inject()</code> on the token. <strong>That’s why since Angular 4.x we don’t have to do this anymore.</strong> We can replace all <code>OpaqueToken</code> instances with <code>InjectionToken</code> instances and everything would work exactly the same way, except for the fact that we don’t have to call <code>new Inject()</code> in factory provider dependencies anymore. Also, notice the generic. It’s the type of what the injector is going to return.</p>

<p>In other words, the code above can then be written like this:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">const</span> <span class="nx">API_URL</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">InjectionToken</span><span class="o">&lt;</span><span class="nx">string</span><span class="o">&gt;</span><span class="p">(</span><span class="s1">'apiUrl'</span><span class="p">);</span> <span class="c1">// generic defines return value of injector</span>


<span class="nl">providers</span><span class="p">:</span> <span class="p">[</span>
  <span class="p">{</span>
    <span class="na">provide</span><span class="p">:</span> <span class="nx">DataService</span><span class="p">,</span>
    <span class="na">useFactory</span><span class="p">:</span> <span class="p">(</span><span class="nx">http</span><span class="p">,</span> <span class="nx">apiUrl</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
      <span class="c1">// create data service</span>
    <span class="p">},</span>
    <span class="na">deps</span><span class="p">:</span> <span class="p">[</span>
      <span class="nx">Http</span><span class="p">,</span>
      <span class="nx">API_URL</span> <span class="c1">// no `new Inject()` needed!</span>
    <span class="p">]</span>
  <span class="p">}</span>
<span class="p">]</span></code></pre></div>

<p>Cool right? As of version 4.x <code>OpaqueToken</code> is considered deprecated.</p>

<h2 id="conclusion">Conclusion</h2>

<p>Opaque tokens are distinguishable and prevent us from running into naming collisions. In addition, they provide a bit better error messages. Whenever we create a token that is not a type, <code>OpaqueToken</code> should be used. If we’re using Angular in version &gt;= 4.x, we use <code>InjectionToken</code> instead.</p>


          
  <h2 id="videos">Videos on this article</h2>
  
    
    <iframe style="width: 100%;" src="http://casts.thoughtram.io/embedded/181222351" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
    
    <iframe style="width: 100%;" src="http://casts.thoughtram.io/embedded/181222354" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
    
  





        
          <section class="thtrm-ad thtrm-ad--plain thtrm-ad--border thtrm-ad-transparent thtrm-section thtrm-section--is-promo is-sticky">
<a href="https://course.machinelabs.ai" title="Order now!" id="event-cta" ><img src="/images/ml-course-ad.png"></a>
</section>


        </div>

        <div class="thtrm-subscriber">
  <h3>Get updates on new articles and trainings.</h3>
  <p>Join over 2400 other developers who get our content first.</p>
  <form action="//thoughtram.us8.list-manage.com/subscribe/post?u=dfbb1507fbced5a20d9dc5698&amp;id=731f22cdca" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" target="_blank" novalidate>
    <label for="mce-EMAIL"></label>
    <input type="email" value="" name="EMAIL" placeholder="Your email address..." required>
    <div style="position: absolute; left: -5000px;"><input type="text" name="b_dfbb1507fbced5a20d9dc5698_731f22cdca" tabindex="-1" value=""></div>
    <input type="submit" value="Subscribe" name="subscribe" class="thtrm-cta thtrm-cta--small">
  </form>
  <p class="thtrm-form__info-text">Information on the performance measurement included in the consent, the use of the mail service provider MailChimp and on the logging of the registration and your rights of revocation can be found in our <a href="https://thoughtram.io/imprint.html" title="Privacy Statement">data protection declaration</a>.</p>
</div>



        <div class="thtrm-social-links">
            <!-- Sharingbutton Facebook -->
            <a class="resp-sharing-button__link" href="https://facebook.com/sharer/sharer.php?u=http%3A%2F%2Fblog.thoughtram.io/angular/2016/05/23/opaque-tokens-in-angular-2.html" target="_blank" aria-label="Share on Facebook">
              <div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--large"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
                <svg version="1.1" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
                    <g>
                        <path d="M18.768,7.465H14.5V5.56c0-0.896,0.594-1.105,1.012-1.105s2.988,0,2.988,0V0.513L14.171,0.5C10.244,0.5,9.5,3.438,9.5,5.32 v2.145h-3v4h3c0,5.212,0,12,0,12h5c0,0,0-6.85,0-12h3.851L18.768,7.465z"/>
                    </g>
                </svg>
                </div>Share on Facebook</div>
            </a>

            <!-- Sharingbutton Twitter -->
            <a class="resp-sharing-button__link" href="https://twitter.com/intent/tweet/?text=How%20to%20prevent%20name%20collisions%20in%20Angular%20providers&amp;url=http://blog.thoughtram.io/angular/2016/05/23/opaque-tokens-in-angular-2.html" target="_blank" aria-label="Share on Twitter">
              <div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--large"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
                <svg version="1.1" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
                    <g>
                        <path d="M23.444,4.834c-0.814,0.363-1.5,0.375-2.228,0.016c0.938-0.562,0.981-0.957,1.32-2.019c-0.878,0.521-1.851,0.9-2.886,1.104 C18.823,3.053,17.642,2.5,16.335,2.5c-2.51,0-4.544,2.036-4.544,4.544c0,0.356,0.04,0.703,0.117,1.036 C8.132,7.891,4.783,6.082,2.542,3.332C2.151,4.003,1.927,4.784,1.927,5.617c0,1.577,0.803,2.967,2.021,3.782 C3.203,9.375,2.503,9.171,1.891,8.831C1.89,8.85,1.89,8.868,1.89,8.888c0,2.202,1.566,4.038,3.646,4.456 c-0.666,0.181-1.368,0.209-2.053,0.079c0.579,1.804,2.257,3.118,4.245,3.155C5.783,18.102,3.372,18.737,1,18.459 C3.012,19.748,5.399,20.5,7.966,20.5c8.358,0,12.928-6.924,12.928-12.929c0-0.198-0.003-0.393-0.012-0.588 C21.769,6.343,22.835,5.746,23.444,4.834z"/>
                    </g>
                </svg>
                </div>Share on Twitter</div>
            </a>

            <!-- Sharingbutton Google+ -->
            <a class="resp-sharing-button__link" href="https://plus.google.com/share?url=http%3A%2F%2Fblog.thoughtram.io/angular/2016/05/23/opaque-tokens-in-angular-2.html" target="_blank" aria-label="Share on Google+">
              <div class="resp-sharing-button resp-sharing-button--google resp-sharing-button--large"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
                <svg version="1.1" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
                    <g>
                        <path d="M11.366,12.928c-0.729-0.516-1.393-1.273-1.404-1.505c0-0.425,0.038-0.627,0.988-1.368 c1.229-0.962,1.906-2.228,1.906-3.564c0-1.212-0.37-2.289-1.001-3.044h0.488c0.102,0,0.2-0.033,0.282-0.091l1.364-0.989 c0.169-0.121,0.24-0.338,0.176-0.536C14.102,1.635,13.918,1.5,13.709,1.5H7.608c-0.667,0-1.345,0.118-2.011,0.347 c-2.225,0.766-3.778,2.66-3.778,4.605c0,2.755,2.134,4.845,4.987,4.91c-0.056,0.22-0.084,0.434-0.084,0.645 c0,0.425,0.108,0.827,0.33,1.216c-0.026,0-0.051,0-0.079,0c-2.72,0-5.175,1.334-6.107,3.32C0.623,17.06,0.5,17.582,0.5,18.098 c0,0.501,0.129,0.984,0.382,1.438c0.585,1.046,1.843,1.861,3.544,2.289c0.877,0.223,1.82,0.335,2.8,0.335 c0.88,0,1.718-0.114,2.494-0.338c2.419-0.702,3.981-2.482,3.981-4.538C13.701,15.312,13.068,14.132,11.366,12.928z M3.66,17.443 c0-1.435,1.823-2.693,3.899-2.693h0.057c0.451,0.005,0.892,0.072,1.309,0.2c0.142,0.098,0.28,0.192,0.412,0.282 c0.962,0.656,1.597,1.088,1.774,1.783c0.041,0.175,0.063,0.35,0.063,0.519c0,1.787-1.333,2.693-3.961,2.693 C5.221,20.225,3.66,19.002,3.66,17.443z M5.551,3.89c0.324-0.371,0.75-0.566,1.227-0.566l0.055,0 c1.349,0.041,2.639,1.543,2.876,3.349c0.133,1.013-0.092,1.964-0.601,2.544C8.782,9.589,8.363,9.783,7.866,9.783H7.865H7.844 c-1.321-0.04-2.639-1.6-2.875-3.405C4.836,5.37,5.049,4.462,5.551,3.89z"/>
                        <polygon points="23.5,9.5 20.5,9.5 20.5,6.5 18.5,6.5 18.5,9.5 15.5,9.5 15.5,11.5 18.5,11.5 18.5,14.5 20.5,14.5 20.5,11.5  23.5,11.5   "/>
                    </g>
                </svg>
                </div>Share on Google+</div>
            </a>
        </div>

        <h3 class="thtrm-section-headline thtrm-section-headline--with-margin">Author</h3>
        <div class="thtrm-article-author">
          <span class="thtrm-article-author-avatar"><img src="/images/author-pascal.jpg" alt="Picture of Pascal Precht"></span>
          <div class="thtrm-article-author-matter">
            <h4 class="thtrm-article-author-name">Pascal Precht</h4>
            <p class="thtrm-article-author-text">Pascal is a front-end engineer and a Angular Developer Expert nominated by Google. He created the angular-translate module, is an Angular contributor and also part of the Angular Docs Authoring team.</p>
            <p>
              <a class="thtrm-article-author-cta thtrm-article-author-cta-twitter" href="http://twitter.com/PascalPrecht" title="Pascal Precht on Twitter">Twitter</a>
              <a class="thtrm-article-author-cta" href="http://github.com/PascalPrecht" title="Pascal Precht on GitHub">GitHub</a>
            </p>
          </div>
        </div>
      </div>

      <div class="thtrm-constraint">

        
        <h4 class="thtrm-section-headline thtrm-section-headline--with-big-margin thtrm-section-headline--centered">Related Posts</h4>
        <ul class="thtrm-three-column-list thtrm-three-column-list--with-padding">
        
        
          
          <li>
            <a class="thtrm-article-card" href="/angular/2016/05/13/angular-2-providers-using-map-literals.html" title="Angular Providers using Map Literals">
              <div class="thtrm-article-card-image" style="background-image: linear-gradient(to bottom, rgba(0,0,0,0) 0%,rgba(0,0,0,0.01) 2%,#29383E 100%),url(/images/banner/angular-2-providers-using-map-literals.png);"></div>
              <div class="thtrm-article-card-content ">
                <h3>Angular Providers using Map Literals</h3>
                <p>Angular has a shorter syntax for creating providers. In this article we're going to take a look at how to...</p>
              </div>
            </a>
          </li>
        
          
          <li>
            <a class="thtrm-article-card" href="/angular/2018/03/05/advanced-caching-with-rxjs.html" title="Advanced caching with RxJS">
              <div class="thtrm-article-card-image" style="background-image: linear-gradient(to bottom, rgba(0,0,0,0) 0%,rgba(0,0,0,0.01) 2%,#29383E 100%),url(/images/banner/advanced_caching.jpg);"></div>
              <div class="thtrm-article-card-content ">
                <h3>Advanced caching with RxJS</h3>
                <p>When building web applications, performance should always be a top priority. One very efficient way to optimize the performance of...</p>
              </div>
            </a>
          </li>
        
          
          <li>
            <a class="thtrm-article-card" href="/angular/2017/11/27/custom-overlays-with-angulars-cdk-part-two.html" title="Custom Overlays with Angular's CDK - Part 2">
              <div class="thtrm-article-card-image" style="background-image: linear-gradient(to bottom, rgba(0,0,0,0) 0%,rgba(0,0,0,0.01) 2%,#29383E 100%),url(/images/banner/custom_overlays_2.jpg);"></div>
              <div class="thtrm-article-card-content ">
                <h3>Custom Overlays with Angular's CDK - Part 2</h3>
                <p>In this follow-up post we demonstrate how to use Angular's CDK to build a custom overlay that looks and feels...</p>
              </div>
            </a>
          </li>
        
          
          <li>
            <a class="thtrm-article-card" href="/angular/2017/11/20/custom-overlays-with-angulars-cdk.html" title="Custom Overlays with Angular's CDK">
              <div class="thtrm-article-card-image" style="background-image: linear-gradient(to bottom, rgba(0,0,0,0) 0%,rgba(0,0,0,0.01) 2%,#29383E 100%),url(/images/banner/custom_overlays.jpg);"></div>
              <div class="thtrm-article-card-content ">
                <h3>Custom Overlays with Angular's CDK</h3>
                <p>The Angular Material CDK provides us with tools to build awesome and high-quality Angular components without adopting the Material Design...</p>
              </div>
            </a>
          </li>
        
          
          <li>
            <a class="thtrm-article-card" href="/angular/2017/11/13/easy-dialogs-with-angular-material.html" title="Easy Dialogs with Angular Material">
              <div class="thtrm-article-card-image" style="background-image: linear-gradient(to bottom, rgba(0,0,0,0) 0%,rgba(0,0,0,0.01) 2%,#29383E 100%),url(/images/banner/easy-dialogs-with-angular-material.jpg);"></div>
              <div class="thtrm-article-card-content ">
                <h3>Easy Dialogs with Angular Material</h3>
                <p>Building modals and dialogs isn't easy - if we do it ourselves. Angular Material comes with a powerful dialog service...</p>
              </div>
            </a>
          </li>
        
          
          <li>
            <a class="thtrm-article-card" href="/angular/2017/07/26/a-web-animations-deep-dive-with-angular.html" title="A web animations deep dive with Angular">
              <div class="thtrm-article-card-image" style="background-image: linear-gradient(to bottom, rgba(0,0,0,0) 0%,rgba(0,0,0,0.01) 2%,#29383E 100%),url(/images/banner/angular-animations.jpg);"></div>
              <div class="thtrm-article-card-content ">
                <h3>A web animations deep dive with Angular</h3>
                <p>Angular comes with a built-in animation system that lets us create powerful animations based on the Web Animations API. In...</p>
              </div>
            </a>
          </li>
        
        
        </ul>
        

      

      </div>
    </main>
    <footer role="contentinfo" class="thtrm-footer thtrm-footer--slim">
  <div class="thtrm-footer-text">
    <img class="thtrm-footer-logo" alt="thoughtram brain" src="/images/thoughtram-brain-white.png">
    <p>This website was created in collaboration with <a href="http://twitter.com/timche_" title="Tim Cheung on Twitter"><strong>Tim Cheung</strong></a> and <a href="http://twitter.com/tim_hartmann_" title="Tim Hartmann on Twitter"><strong>Tim Hartmann</strong></a>.</p>
    <p ><a href="http://thoughtram.io/code-of-conduct.html" title="Code of Conduct">Code of Conduct</a> &bullet; <a href="http://thoughtram.io/imprint.html" title="Legal Notice">Legal notice</a></p>
    <p class="thtrm-footer-bottom">&copy; 2014-2017 thoughtram GmbH</p>
  </div>
</footer>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-51360648-2', 'auto');
ga('send', 'pageview');

var form = document.getElementById('search-form');
var eventCta = document.getElementById('event-cta');

if (eventCta) {

  eventCta.addEventListener('click', function (event) {
    event.preventDefault();

    setTimeout(clickLink, 1000);

    function clickLink() {
      window.location.replace(eventCta.getAttribute('href'));
    }

    ga('send', 'event', {
      eventCategory: 'Event Link',
      eventAction: 'click',
      eventLabel: eventCta.getAttribute('title'),
      hitCallback: clickLink
    });
  });
}

if (form) {

  var searchTerm = document.getElementById('search-term');

  form.addEventListener('submit', function(event) {
    event.preventDefault();

    var formSubmitted = false;

    setTimeout(submitForm, 1000);

    function submitForm() {
      if (!formSubmitted) {
        formSubmitted = true;
        form.submit();
      }
    }

    ga('send', 'event', {
      eventCategory: 'Search Form',
      eventAction: 'submit',
      eventLabel: searchTerm.value,
      hitCallback: submitForm
    });
  });
}
</script>



    <script src="/scripts/linkjuice/dist/linkjuice.js"></script>
    <script src="/scripts/main.js"></script>
  </body>
</html>
