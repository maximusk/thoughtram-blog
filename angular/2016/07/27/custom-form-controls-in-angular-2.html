




<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Angular makes it very easy to create custom form controls. Read on to learn how to do it!">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="thoughtram">
    <title>Custom Form Controls in Angular by thoughtram</title>
    <meta name="google-site-verification" content="o9eGPEgIETEqYGombq7NiQuBIB_qa6gz1yAL7PxKyK0">

    <!-- Add to homescreen for Chrome on Android -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#4D8799">
    <link rel="icon" sizes="192x192" href="/images/touch/chrome-touch-icon-192x192.png">

    <!-- Add to homescreen for Safari on iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-title" content="thoughtram">
    <link rel="apple-touch-icon" href="/images/touch/apple-touch-icon.png">

    <!-- Tile icon for Win8 (144x144 + tile color) -->
    <meta name="msapplication-TileImage" content="/images/touch/ms-touch-icon-144x144-precomposed.png">
    <meta name="msapplication-TileColor" content="#4D8799">

    <meta property="og:locale" content="en_US">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Custom Form Controls in Angular">
    <meta property="og:description" content="Angular makes it very easy to create custom form controls. Read on to learn how to do it!">
    <meta property="og:url" content="http://blog.thoughtram.io/angular/2016/07/27/custom-form-controls-in-angular-2.html">
    <meta property="og:site_name" content="Articles by thoughtram">
    <meta property="og:image" content="http://blog.thoughtram.io/images/banner/custom-form-controls-in-angular-2.jpg">
    <meta property="og:publisher" content="http://www.facebook.com/thoughtram">

    <meta property="twitter:card" content="summary">
    <meta property="twitter:title" content="Custom Form Controls in Angular">
    <meta property="twitter:site" content="thoughtram Blog">

    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="stylesheet" href="/css/main.css" type="text/css">
  </head>
  <body class="sub-site">
    <!-- Add your site or app content here -->

    <!--[if lt IE 10]>
        <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->

    <header class="thtrm-header" role="banner">
      <div class="thtrm-header-bar">
        <div class="thtrm-constraint">
          <a href="http://thoughtram.io" class="thtrm-header-logo-link" title="thoughtram.io Start Page"><h1 class="thtrm-header-logo">thoughtram</h1></a>
          <div class="thtrm-header-menu-wrapper">
            <span role="button" tabindex="0" class="thtrm-header-menu-label">Menu</span>
            <ul class="thtrm-header-menu">
              <li><a title="Training" class="thtrm-header-menu-item" href="http://thoughtram.io/training.html">Training</a></li>
              <li><a title="Code Review" class="thtrm-header-menu-item" href="http://thoughtram.io/code-review.html">Code Review</a></li>
              <li><a title="Casts" class="thtrm-header-menu-item " href="http://casts.thoughtram.io">Casts</a></li>
              <li><a title="Blog" class="thtrm-header-menu-item" href="/">Blog</a></li>
            </ul>
          </div>
        </div>
      </div>
    </header>

    <main role="main" class="thtrm-main">
    <div class="thtrm-banner" style="background-image: linear-gradient(to bottom, rgba(0,0,0,0) 0%,rgba(0,0,0,0.01) 2%,#29383E 100%), url('/images/banner/custom-form-controls-in-angular-2.jpg');">
        <hgroup class="thtrm-banner-container">
          <div class="thtrm-constraint thtrm-constraint--slim">
            <h2 class="thtrm-banner-text">Custom Form Controls in Angular</h2>
            <span>by <a href="http://twitter.com/" title="Pascal Precht on Twitter">Pascal Precht</a> on Jul 27, 2016, last updated on Dec 18, 2016<br>26 minute read</span>

          </div>
        </hgroup>
      </div>
      <div class="thtrm-constraint thtrm-constraint--slim">

        <section class="thtrm-ad thtrm-section thtrm-section--is-promo is-sticky">
  <img width="100" src="/images/angular2-shield-inverse.svg">
  <h3 class="thtrm-section-headline">Angular Master Class in Las Palmas</h3>
  <p class="thtrm-section-text">Join our upcoming public training!</p>
  <a href="https://www.codecamps.com/aiff4/" title="Angular Master Class in Las Palmas" id="event-cta" class="thtrm-layout-divider-cta">Get a ticket <strong>&rarr;</strong></a>
</section>

        <div class="thtrm-article">

          <p>There are many things that Angular helps us out with when creating forms. We’ve covered several topics on <a href="/forms-in-angular-2">Forms in Angular</a>, like model-driven forms and template-driven forms. If you haven’t read those articles yet, we highly recommend you to do so as this one is based on them. <a href="http://twitter.com/kryptos_rsa">Almero Steyn</a>, one of our training students, who later on contributed to the official documentation as part of the Docs Authoring Team for Angular, has also written a very nice <a href="http://almerosteyn.com/2016/04/linkup-custom-control-to-ngcontrol-ngmodel">introduction</a> to creating custom controls.</p>

<p>His article inspired us and we would like to take it a step further and explore how to create custom form controls that integrate nicely with Angular’s form APIs.</p>

<p style="text-align: center; margin-bottom: -1em;"><strong>Want to see things in action first?</strong></p>

<p class="thtrm-ctas">

  
    <a href="#demos" class="thtrm-cta thtrm-cta--small"><i class="material-icons">code</i> View Demos</a>
  

  

</p>

<div class="thtrm-toc is-sticky">
  <h3 class="no_toc" id="table-of-contents">TABLE OF CONTENTS</h3>
<ul id="markdown-toc">
  <li><a href="#custom-form-control-considerations" id="markdown-toc-custom-form-control-considerations">Custom form control considerations</a></li>
  <li><a href="#creating-a-custom-counter" id="markdown-toc-creating-a-custom-counter">Creating a custom counter</a></li>
  <li><a href="#understanding-controlvalueaccessor" id="markdown-toc-understanding-controlvalueaccessor">Understanding ControlValueAccessor</a></li>
  <li><a href="#implementing-controlvalueaccessor" id="markdown-toc-implementing-controlvalueaccessor">Implementing ControlValueAccessor</a></li>
  <li><a href="#registering-the-controlvalueaccessor" id="markdown-toc-registering-the-controlvalueaccessor">Registering the ControlValueAccessor</a></li>
  <li><a href="#using-it-inside-template-driven-forms" id="markdown-toc-using-it-inside-template-driven-forms">Using it inside template-driven forms</a></li>
  <li><a href="#using-it-inside-model-driven-forms" id="markdown-toc-using-it-inside-model-driven-forms">Using it inside model-driven forms</a></li>
  <li><a href="#adding-custom-validation" id="markdown-toc-adding-custom-validation">Adding custom validation</a></li>
  <li><a href="#making-the-validator-testable" id="markdown-toc-making-the-validator-testable">Making the validator testable</a></li>
  <li><a href="#making-the-validation-configurable" id="markdown-toc-making-the-validation-configurable">Making the validation configurable</a></li>
</ul>

</div>

<h2 id="custom-form-control-considerations">Custom form control considerations</h2>

<p>Before we get started and build our own custom form control, we want to make sure that we have an idea of the things come into play when creating custom form controls.</p>

<p>First of all, it’s important to realise that we shouldn’t just create custom form controls right away, if there’s a native element (like <code>&lt;input type="number"&gt;</code>) that perfectly takes care of the job. It seems native form elements are often underestimated in what they are capable of. While we often just see a text box that we can type into, it does way more work for us. <strong>Every native form element is accessible</strong>, some inputs have built-in validation and some even provide an improved user experience on different platforms (e.g. mobile browsers).</p>

<p>So whenever we think of creating a custom form control we should ask ourselves:</p>

<ul>
  <li>Is there a native element that has the same semantics?</li>
  <li>If yes, can we simply rely on that element and use CSS and/or progressive enhancement to change its appearance/behaviour to our needs?</li>
  <li>If not, what will the custom control look like?</li>
  <li>How can we make it accessible?</li>
  <li>Does it behave differently on different platforms?</li>
  <li>How does it validate?</li>
</ul>

<p>There are probably more things to consider, but these are the most important ones. If we do decide to create a custom form control (in Angular), we should make sure that:</p>

<ul>
  <li>It properly propagates changes to the DOM/View</li>
  <li>It properly propagates changes to the Model</li>
  <li>It comes with custom validation if needed</li>
  <li>It adds validity state to the DOM so it can be styled</li>
  <li><strong>It’s accessible</strong></li>
  <li>It works with template-driven forms</li>
  <li>It works with model-driven forms</li>
  <li>It needs to be responsive</li>
</ul>

<p>We will discuss different scenarios through out this article to demonstrate how these things can be implemented. <strong>We will not cover accessibility in this article</strong> though, as there’ll be follow-up articles to talk about that in-depth.</p>

<h2 id="creating-a-custom-counter">Creating a custom counter</h2>

<p>Let’s start off with a rather simple counter component. The idea is to have a component that lets us increment and decrement a model value. And yes, if we think about the <a href="#things-to-consider">things to consider</a>, we probably realise that an <code>&lt;input type="number"&gt;</code> would do the trick.</p>

<p>However, in this article we want to demonstrate how to implement a custom form control and a custom counter component seems trivial enough to make things look not too complicated. In addition, our counter component will have a different appearance that should work the same across all browsers, which is where we might reach the boundaries of a native input element anyways.</p>

<p>We start off with the raw component. All we need is a model value that can be changed and two buttons that cause the change.</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">Input</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'@angular/core'</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span><span class="p">({</span>
  <span class="na">selector</span><span class="p">:</span> <span class="s1">'counter-input'</span><span class="p">,</span>
  <span class="na">template</span><span class="p">:</span> <span class="err">`</span>
    <span class="o">&lt;</span><span class="nx">button</span> <span class="p">(</span><span class="nx">click</span><span class="p">)</span><span class="o">=</span><span class="s2">"increment()"</span><span class="o">&gt;+&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>    <span class="p">{{</span><span class="nx">counterValue</span><span class="p">}}</span>
    <span class="o">&lt;</span><span class="nx">button</span> <span class="p">(</span><span class="nx">click</span><span class="p">)</span><span class="o">=</span><span class="s2">"decrement()"</span><span class="o">&gt;-&lt;</span><span class="sr">/button</span><span class="err">&gt;
</span>  <span class="err">`</span>
<span class="p">})</span>
<span class="kr">class</span> <span class="nx">CounterInputComponent</span> <span class="p">{</span>

  <span class="err">@</span><span class="nx">Input</span><span class="p">()</span>
  <span class="nx">counterValue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="nx">increment</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">counterValue</span><span class="o">++</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">decrement</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">counterValue</span><span class="o">--</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>Nothing special going on here. <code>CounterInputComponent</code> has a model <code>counterValue</code> that is interpolated in its template and can be incremented or decremented by the <code>increment()</code> and <code>decrement()</code> methods respectively. This component works perfectly fine, we can already use it once declared on our application module, as it is by putting it into another component like this:</p>

<p><strong>app.module.ts</strong></p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="err">@</span><span class="nx">NgModule</span><span class="p">({</span>
  <span class="na">imports</span><span class="p">:</span> <span class="p">[</span><span class="nx">BrowserModule</span><span class="p">],</span>
  <span class="na">declarations</span><span class="p">:</span> <span class="p">[</span><span class="nx">AppComponent</span><span class="p">,</span> <span class="nx">CounterInputComponent</span><span class="p">],</span>
  <span class="na">bootstrap</span><span class="p">:</span> <span class="p">[</span><span class="nx">AppComponent</span><span class="p">]</span>
<span class="p">})</span>
<span class="kr">export</span> <span class="kr">class</span> <span class="nx">AppModule</span> <span class="p">{}</span></code></pre></div>

<p><strong>app.component.ts</strong></p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Component</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'@angular/core'</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span><span class="p">({</span>
  <span class="na">selector</span><span class="p">:</span> <span class="s1">'app-component'</span><span class="p">,</span>
  <span class="na">template</span><span class="p">:</span> <span class="err">`</span>
    <span class="o">&lt;</span><span class="nx">counter</span><span class="o">-</span><span class="nx">input</span><span class="o">&gt;&lt;</span><span class="sr">/counter-input</span><span class="err">&gt;
</span>  <span class="err">`</span><span class="p">,</span>
<span class="p">})</span>
<span class="kr">class</span> <span class="nx">AppComponent</span> <span class="p">{}</span></code></pre></div>

<p>Okay cool, but now we want to make it work with Angular’s form APIs. Ideally, what we end up with is a custom control that works with template-driven forms and reactive/model-driven forms. For example, in the most simple scenario, we should be able to create a template-driven form like this:</p>

<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="c">&lt;!-- this doesn't work YET --&gt;</span>
<span class="nt">&lt;form</span> <span class="err">#</span><span class="na">form=</span><span class="s">"ngForm"</span> <span class="err">(</span><span class="na">ngSubmit</span><span class="err">)="</span><span class="na">submit</span><span class="err">(</span><span class="na">form</span><span class="err">.</span><span class="na">value</span><span class="err">)"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;counter-input</span> <span class="na">name=</span><span class="s">"counter"</span> <span class="na">ngModel</span><span class="nt">&gt;&lt;/counter-input&gt;</span>
  <span class="nt">&lt;button</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>Submit<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/form&gt;</span></code></pre></div>

<p>If that syntax is new to you, check out our article on <a href="/angular/2016/03/21/template-driven-forms-in-angular-2.html">Template-Driven forms in Angular</a>. Okay but how do we get there? We need to learn what a <code>ControlValueAccessor</code> is, because that’s the thing that Angular uses to build a bridge between a form model and a DOM element.</p>

<h2 id="understanding-controlvalueaccessor">Understanding ControlValueAccessor</h2>

<p>While our counter component works, there’s currently no way we can connect it to an outer form. In fact, if we try to bind any kind of form model to our custom control, we’ll get an error that there’s a missing <code>ControlValueAccessor</code>. And that’s exactly what we need to enable proper integration with forms in Angular.</p>

<p>So, what is a <code>ControlValueAccessor</code>? Well, remember the things we talked about earlier that are needed to implement a custom form control? One of the things we need to make sure is that changes are propagated from the model to the view/DOM, and also from the view, back to the model. <strong>This is what a <code>ControlValueAccessor</code> is for.</strong></p>

<p>A <code>ControlValueAccessor</code> is an interface that takes care of:</p>

<ul>
  <li>Writing a value from the form model into the view/DOM</li>
  <li>Informing other form directives and controls when the view/DOM changes</li>
</ul>

<p>The reason why Angular has such an interface, is because the way how DOM elements need to be updated can vary across input types. For example, a normal text input has a <code>value</code> property that needs to be written to, whereas a checkbox comes with a <code>checked</code> property that needs to be updated. If we take a look under the hood, we realise that <strong>there’s a <code>ControlValueAccessor</code> for every input type</strong>  which knows how to update its view/DOM.</p>

<p>There’s the <code>DefaultValueAccessor</code> that takes care of text inputs and textareas, the <code>SelectControlValueAccessor</code> that handles select inputs, or the <code>CheckboxControlValueAccessor</code>, which, surprise, deals with checkboxes, and many more.</p>

<p>Our counter component needs a <code>ControlValueAccessor</code> that knows how to update the <code>counterValue</code> model and inform the outside world about changes too. As soon as we implement that interface, it’ll be able to talk to Angular forms.</p>

<h2 id="implementing-controlvalueaccessor">Implementing ControlValueAccessor</h2>

<p>The <code>ControlValueAccessor</code> interface looks like this:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">export</span> <span class="kr">interface</span> <span class="nx">ControlValueAccessor</span> <span class="p">{</span>
  <span class="nx">writeValue</span><span class="p">(</span><span class="nx">obj</span><span class="err">:</span> <span class="nx">any</span><span class="p">)</span> <span class="err">:</span> <span class="k">void</span>
  <span class="nx">registerOnChange</span><span class="p">(</span><span class="nx">fn</span><span class="err">:</span> <span class="nx">any</span><span class="p">)</span> <span class="err">:</span> <span class="k">void</span>
  <span class="nx">registerOnTouched</span><span class="p">(</span><span class="nx">fn</span><span class="err">:</span> <span class="nx">any</span><span class="p">)</span> <span class="err">:</span> <span class="k">void</span>
<span class="p">}</span></code></pre></div>

<p><strong>writeValue(obj: any)</strong> is the method that writes a new value from the form model into the view or (if needed) DOM property. This is where we want to update our <code>counterValue</code> model, as that’s the thing that is used in the view.</p>

<p><strong>registerOnChange(fn: any)</strong> is a method that registers a handler that should be called when something in the view has changed. It gets a function that tells other form directives and form controls to update their values. In other words, that’s the handler function we want to call whenever <code>counterValue</code> changes through the view.</p>

<p><strong>registerOnTouched(fn: any)</strong> Similiar to <code>registerOnChange()</code>, this registers a handler specifically for when a control receives a touch event. We don’t need that in our custom control.</p>

<p>A <code>ControlValueAccessor</code> needs access to its control’s view and model, which means, the custom form control itself has to implement that interface. Let’s start with <code>writeValue()</code>. First we import the interface and update the class signature.</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="p">{</span> <span class="nx">ControlValueAccessor</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'@angular/forms'</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span><span class="p">(...)</span>
<span class="kr">class</span> <span class="nx">CounterInputComponent</span> <span class="kr">implements</span> <span class="nx">ControlValueAccessor</span> <span class="p">{</span>
  <span class="p">...</span>
<span class="p">}</span></code></pre></div>

<p>Next, we implement <code>writeValue()</code>. As mentioned earlier, it takes a new value from the form model and writes it into the view. In our case, all we need is updating the <code>counterValue</code> property, as it’s interpolated automatically.</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="err">@</span><span class="nx">Component</span><span class="p">(...)</span>
<span class="kr">class</span> <span class="nx">CounterInputComponent</span> <span class="kr">implements</span> <span class="nx">ControlValueAccessor</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="nx">writeValue</span><span class="p">(</span><span class="nx">value</span><span class="err">:</span> <span class="nx">any</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">counterValue</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>This method gets called when the form is initialized, with the form model’s initial value. This means it will override the default value <code>0</code>, which is fine but if we think about the simple form setup we talked about earlier, we realise that there is no initial value in the form model:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="o">&lt;</span><span class="nx">counter</span><span class="o">-</span><span class="nx">input</span> <span class="nx">name</span><span class="o">=</span><span class="s2">"counter"</span> <span class="nx">ngModel</span><span class="o">&gt;&lt;</span><span class="sr">/counter-input&gt;</span></code></pre></div>

<p>This will cause our component to render an empty string. As a quick fix, we only set the value when it’s not undefined:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="nx">writeValue</span><span class="p">(</span><span class="nx">value</span><span class="err">:</span> <span class="nx">any</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">value</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">counterValue</span> <span class="o">=</span> <span class="nx">value</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>Now, it only overrides the default when there’s an actual value written to the control. Next, we implement <code>registerOnChange()</code> and <code>registerOnTouched()</code>. <code>registerOnChange()</code> has access to a function that informs the outside world about changes. Here’s where we can do special work, whenever we propagate the change, if we wanted to. <code>registerOnTouched()</code> registers a callback that is excuted whenever a form control is “touched”. E.g. when an input element blurs, it fire the touch event. We don’t want to do anything at this event, so we can implement the interface with an empty function.</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="err">@</span><span class="nx">Component</span><span class="p">(...)</span>
<span class="kr">class</span> <span class="nx">CounterInputComponent</span> <span class="kr">implements</span> <span class="nx">ControlValueAccessor</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="nx">propagateChange</span> <span class="o">=</span> <span class="p">(</span><span class="nx">_</span><span class="err">:</span> <span class="nx">any</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{};</span>

  <span class="nx">registerOnChange</span><span class="p">(</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">propagateChange</span> <span class="o">=</span> <span class="nx">fn</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">registerOnTouched</span><span class="p">()</span> <span class="p">{}</span>
<span class="p">}</span></code></pre></div>

<p>Great, our counter input now implements the <code>ControlValueAccessor</code> interface. The next thing we need to do is to call <code>propagateChange()</code> with the value whenever <code>counterValue</code> changes through the view. In other words, if either the <code>increment()</code> or <code>decrement()</code> button is clicked, we want to propagate the new value to the outside world.</p>

<p>Let’s update these methods accordingly.</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="err">@</span><span class="nx">Component</span><span class="p">(...)</span>
<span class="kr">class</span> <span class="nx">CounterInputComponent</span> <span class="kr">implements</span> <span class="nx">ControlValueAccessor</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="nx">increment</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">counterValue</span><span class="o">++</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">propagateChange</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">counterValue</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">decrement</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">counterValue</span><span class="o">--</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">propagateChange</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">counterValue</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>We can make this code a little better using property mutators. Both methods, <code>increment()</code> and <code>decrement()</code>, call <code>propagateChange()</code> whenever <code>counterValue</code> changes. Let’s use getters and setters to get rid off the redudant code:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="err">@</span><span class="nx">Component</span><span class="p">(...)</span>
<span class="kr">class</span> <span class="nx">CounterInputComponent</span> <span class="kr">implements</span> <span class="nx">ControlValueAccessor</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="err">@</span><span class="nx">Input</span><span class="p">()</span>
  <span class="nx">_counterValue</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// notice the '_'</span>

  <span class="nx">get</span> <span class="nx">counterValue</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_counterValue</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">set</span> <span class="nx">counterValue</span><span class="p">(</span><span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_counterValue</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">propagateChange</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_counterValue</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">increment</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">counterValue</span><span class="o">++</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="nx">decrement</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">counterValue</span><span class="o">--</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p><code>CounterInputComponent</code> is almost ready for prime-time. Even though it implements the <code>ControlValueAccessor</code> interface, there’s nothing that tells Angular that it should be considered as such. We need to register it.</p>

<h2 id="registering-the-controlvalueaccessor">Registering the ControlValueAccessor</h2>

<p>Implementing the interface is only half of the story. As we know, interfaces don’t exist in ES5, which means once the code is transpiled, that information is gone. So after all, it happens that our component implements the interface, but we still need to make Angular pick it up as such.</p>

<p>In our article on <a href="/angular2/2015/11/23/multi-providers-in-angular-2.html">multi-providers in Angular</a> we learned that there are some DI tokens that Angular uses to inject multiple values, to do certain things with them. For example there’s the <code>NG_VALIDATORS</code> token that gives Angular all registered validators on a form control, and we can add our own validators to it.</p>

<p>In order to get hold of a <code>ControlValueAccessor</code> for a form control, Angular internaly injects all values that are registered on the <code>NG_VALUE_ACCESSOR</code> token. So all we need to do is to extend the multi-provider for <code>NG_VALUE_ACCESSOR</code> with our own value accessor instance (which is our component).</p>

<p>Let’s do that right away:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Component</span><span class="p">,</span> <span class="nx">Input</span><span class="p">,</span> <span class="nx">forwardRef</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'@angular/core'</span><span class="p">;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">ControlValueAccessor</span><span class="p">,</span> <span class="nx">NG_VALUE_ACCESSOR</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'@angular/forms'</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span><span class="p">({</span>
  <span class="p">...</span>
  <span class="na">providers</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span> 
      <span class="na">provide</span><span class="p">:</span> <span class="nx">NG_VALUE_ACCESSOR</span><span class="p">,</span>
      <span class="na">useExisting</span><span class="p">:</span> <span class="nx">forwardRef</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">CounterInputComponent</span><span class="p">),</span>
      <span class="na">multi</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">})</span>
<span class="kr">class</span> <span class="nx">CounterInputComponent</span> <span class="p">{</span>
  <span class="p">...</span>
<span class="p">}</span></code></pre></div>

<p>If this code doesn’t make any sense to you, you should definitely check out our article on <a href="/angular2/2015/11/23/multi-providers-in-angular-2.html">multi-providers in Angular</a>, but the bottom line is, that we’re adding our custom value accessor to the DI system so Angular can get an instance of it. We also have to use <code>useExisting</code> because <code>CounterInputComponent</code> will be already created as a directive dependency in the component that uses it. If we don’t do that, we get a new instance as this is how DI in Angular works. The <code>forwardRef()</code> call is explained in <a href="/angular/2015/09/03/forward-references-in-angular-2.html">this article</a>.</p>

<p>Awesome, our custom form control is now ready to be used!</p>

<h2 id="using-it-inside-template-driven-forms">Using it inside template-driven forms</h2>

<p>We’ve already seen that the counter component works as intended, but now we want to put it inside an actual form and make sure it works in all common scenarios.</p>

<h3 id="activating-form-apis">Activating form APIs</h3>

<p>As discussed in our article on <a href="/angular/2016/03/21/template-driven-forms-in-angular-2.html#activating-new-form-apis">template-driven forms in Angular</a>, we need to activate the form APIs like this:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="p">{</span> <span class="nx">FormsModule</span><span class="p">}</span> <span class="nx">from</span> <span class="s1">'@angular/forms'</span><span class="p">;</span>

<span class="err">@</span><span class="nx">NgModule</span><span class="p">({</span>
  <span class="na">imports</span><span class="p">:</span> <span class="p">[</span><span class="nx">BrowserModule</span><span class="p">,</span> <span class="nx">FormsModule</span><span class="p">],</span> <span class="c1">// we're add FormsModule here</span>
  <span class="p">...</span>
<span class="p">})</span>
<span class="kr">export</span> <span class="kr">class</span> <span class="nx">AppModule</span> <span class="p">{}</span></code></pre></div>

<h3 id="without-model-initialization">Without model initialization</h3>

<p>That’s pretty much it! Remember our <code>AppComponent</code> from ealier? Let’s create a template-driven form in it and see if it works. Here’s an example that uses the counter control without initializing it with a value (it will use its own internal default value which is <code>0</code>):</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="err">@</span><span class="nx">Component</span><span class="p">({</span>
  <span class="na">selector</span><span class="p">:</span> <span class="s1">'app-component'</span><span class="p">,</span>
  <span class="na">template</span><span class="p">:</span> <span class="err">`</span>
    <span class="o">&lt;</span><span class="nx">form</span> <span class="err">#</span><span class="nx">form</span><span class="o">=</span><span class="s2">"ngForm"</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">counter</span><span class="o">-</span><span class="nx">input</span> <span class="nx">name</span><span class="o">=</span><span class="s2">"counter"</span> <span class="nx">ngModel</span><span class="o">&gt;&lt;</span><span class="sr">/counter-input</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="sr">/form</span><span class="err">&gt;
</span>
    <span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">form</span><span class="p">.</span><span class="nx">value</span> <span class="o">|</span> <span class="nx">json</span> <span class="p">}}</span><span class="o">&lt;</span><span class="sr">/pre</span><span class="err">&gt;
</span>  <span class="err">`</span>
<span class="p">})</span>
<span class="kr">class</span> <span class="nx">AppComponent</span> <span class="p">{}</span></code></pre></div>

<blockquote>
  <p><strong>Special Tip:</strong> Using the json pipe is a great trick to debug a form’s value.</p>
</blockquote>

<p><code>form.value</code> returns the values of all form controls mapped to their names in a JSON structure. That’s why <code>JsonPipe</code> will out put an object literal with a <code>counter</code> field of the value that the counter has.</p>

<h3 id="model-initialization-with-property-binding">Model initialization with property binding</h3>

<p>Here’s another example that binds a value to the custom control using property binding:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="err">@</span><span class="nx">Component</span><span class="p">({</span>
  <span class="na">selector</span><span class="p">:</span> <span class="s1">'app-component'</span><span class="p">,</span>
  <span class="na">template</span><span class="p">:</span> <span class="err">`</span>
    <span class="o">&lt;</span><span class="nx">form</span> <span class="err">#</span><span class="nx">form</span><span class="o">=</span><span class="s2">"ngForm"</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">counter</span><span class="o">-</span><span class="nx">input</span> <span class="nx">name</span><span class="o">=</span><span class="s2">"counter"</span> <span class="p">[</span><span class="nx">ngModel</span><span class="p">]</span><span class="o">=</span><span class="s2">"outerCounterValue"</span><span class="o">&gt;&lt;</span><span class="sr">/counter-input</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="sr">/form</span><span class="err">&gt;
</span>
    <span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">form</span><span class="p">.</span><span class="nx">value</span> <span class="o">|</span> <span class="nx">json</span> <span class="p">}}</span><span class="o">&lt;</span><span class="sr">/pre</span><span class="err">&gt;
</span>  <span class="err">`</span>
<span class="p">})</span>
<span class="kr">class</span> <span class="nx">AppComponent</span> <span class="p">{</span>
  <span class="nx">outerCounterValue</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>  
<span class="p">}</span></code></pre></div>

<h3 id="two-way-data-binding-with-ngmodel-template-driven">Two-way data binding with ngModel</h3>

<p>And of course, we can take advantage of <code>ngModel</code>’s two-way data binding implementation simply by changing the syntax to this:</p>

<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;p&gt;</span>ngModel value: {{outerCounterValue}}<span class="nt">&lt;/p&gt;</span>
<span class="nt">&lt;counter-input</span> <span class="na">name=</span><span class="s">"counter"</span> <span class="err">[(</span><span class="na">ngModel</span><span class="err">)]="</span><span class="na">outerCounterValue</span><span class="err">"</span><span class="nt">&gt;&lt;/counter-input&gt;</span></code></pre></div>

<p>How cool is that? Our custom form control works seamlessly with the template-driven forms APIs! Let’s see what that looks like when using model-driven forms.</p>

<h2 id="using-it-inside-model-driven-forms">Using it inside model-driven forms</h2>

<p>The following examples use Angular’s reactive form directives, so don’t forget to add <code>ReactiveFormsModule</code> to <code>AppModule</code> as discussed in <a href="/angular/2016/06/22/model-driven-forms-in-angular-2.html">this article</a>.</p>

<h3 id="binding-value-via-formcontrolname">Binding value via formControlName</h3>

<p>Once we’ve set up a <code>FormGroup</code> that represents our form model, we can bind it to a form element and associate each control using <code>formControlName</code>. This example binds a value to our custom form control from a form model:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="err">@</span><span class="nx">Component</span><span class="p">({</span>
  <span class="na">selector</span><span class="p">:</span> <span class="s1">'app-component'</span><span class="p">,</span>
  <span class="na">template</span><span class="p">:</span> <span class="err">`</span>
    <span class="o">&lt;</span><span class="nx">form</span> <span class="p">[</span><span class="nx">formGroup</span><span class="p">]</span><span class="o">=</span><span class="s2">"form"</span><span class="o">&gt;</span>
      <span class="o">&lt;</span><span class="nx">counter</span><span class="o">-</span><span class="nx">input</span> <span class="nx">formControlName</span><span class="o">=</span><span class="s2">"counter"</span><span class="o">&gt;&lt;</span><span class="sr">/counter-input</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="sr">/form</span><span class="err">&gt;
</span>
    <span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">form</span><span class="p">.</span><span class="nx">value</span> <span class="o">|</span> <span class="nx">json</span> <span class="p">}}</span><span class="o">&lt;</span><span class="sr">/pre</span><span class="err">&gt;
</span>  <span class="err">`</span>
<span class="p">})</span>
<span class="kr">class</span> <span class="nx">AppComponent</span> <span class="kr">implements</span> <span class="nx">OnInit</span> <span class="p">{</span>

  <span class="nl">form</span><span class="p">:</span> <span class="nx">FormGroup</span><span class="p">;</span>

  <span class="nx">constructor</span><span class="p">(</span><span class="kr">private</span> <span class="nx">fb</span><span class="err">:</span> <span class="nx">FormBuilder</span><span class="p">)</span> <span class="p">{}</span>

  <span class="nx">ngOnInit</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">form</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">fb</span><span class="p">.</span><span class="nx">group</span><span class="p">({</span>
      <span class="na">counter</span><span class="p">:</span> <span class="mi">5</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<h2 id="adding-custom-validation">Adding custom validation</h2>

<p>One last thing we want to take a look at is how we can add validation to our custom control. In fact, we’ve already written an article on <a href="/angular/2016/03/14/custom-validators-in-angular-2.html">custom validators in Angular</a> and everything we need to know is written down there. However, to make things more clear we’ll add a custom validator to our custom form control by example.</p>

<p>Let’s say we want to teach our control to become invalid when its <code>counterValue</code> is greater than <code>10</code> or smaller than <code>0</code>. Here’s what it could look like:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="p">{</span> <span class="nx">NG_VALIDATORS</span><span class="p">,</span> <span class="nx">FormControl</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'@angular/forms'</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span><span class="p">({</span>
  <span class="p">...</span>
  <span class="na">providers</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span> 
      <span class="na">provide</span><span class="p">:</span> <span class="nx">NG_VALIDATORS</span><span class="p">,</span>
      <span class="na">useValue</span><span class="p">:</span> <span class="p">(</span><span class="na">c</span><span class="p">:</span> <span class="nx">FormControl</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
        <span class="kd">let</span> <span class="nx">err</span> <span class="o">=</span> <span class="p">{</span>
          <span class="na">rangeError</span><span class="p">:</span> <span class="p">{</span>
            <span class="na">given</span><span class="p">:</span> <span class="nx">c</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span>
            <span class="na">max</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
            <span class="na">min</span><span class="p">:</span> <span class="mi">0</span>
          <span class="p">}</span>
        <span class="p">};</span>

        <span class="k">return</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">value</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="o">||</span> <span class="nx">c</span><span class="p">.</span><span class="nx">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">?</span> <span class="nx">err</span> <span class="p">:</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">},</span>
      <span class="na">multi</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">})</span>
<span class="kr">class</span> <span class="nx">CounterInputComponent</span> <span class="kr">implements</span> <span class="nx">ControlValueAccessor</span> <span class="p">{</span>
  <span class="p">...</span>
<span class="p">}</span></code></pre></div>

<p>We register a validator function that returns <code>null</code> if the control value is valid, or an error object when it’s not. This already works great, we can display an error message accordingly like this:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="o">&lt;</span><span class="nx">form</span> <span class="p">[</span><span class="nx">formGroup</span><span class="p">]</span><span class="o">=</span><span class="s2">"form"</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="nx">counter</span><span class="o">-</span><span class="nx">input</span>
    <span class="nx">formControlName</span><span class="o">=</span><span class="s2">"counter"</span>
    <span class="o">&gt;&lt;</span><span class="sr">/counter-input</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/form</span><span class="err">&gt;
</span>
<span class="o">&lt;</span><span class="nx">p</span> <span class="o">*</span><span class="nx">ngIf</span><span class="o">=</span><span class="s2">"!form.valid"</span><span class="o">&gt;</span><span class="nx">Counter</span> <span class="nx">is</span> <span class="nx">invalid</span><span class="o">!&lt;</span><span class="sr">/p</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="nx">pre</span><span class="o">&gt;</span><span class="p">{{</span> <span class="nx">form</span><span class="p">.</span><span class="nx">value</span> <span class="o">|</span> <span class="nx">json</span> <span class="p">}}</span><span class="o">&lt;</span><span class="sr">/pre&gt;</span></code></pre></div>

<h2 id="making-the-validator-testable">Making the validator testable</h2>

<p>We can do a little bit better though. When using model-driven forms, we might want to test the component that has the form without the DOM. In that case, the validator wouldn’t exist, as it’s provided by the counter input component. This can be easily fixed by extracting the validator function into its own declaration and exporting it, so other modules can import it when needed.</p>

<p>Let’s change our code to this:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">export</span> <span class="kd">function</span> <span class="nx">validateCounterRange</span><span class="p">(</span><span class="nx">c</span><span class="err">:</span> <span class="nx">FormControl</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">err</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">rangeError</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">given</span><span class="p">:</span> <span class="nx">c</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span>
      <span class="na">max</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
      <span class="na">min</span><span class="p">:</span> <span class="mi">0</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="k">return</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">value</span> <span class="o">&gt;</span> <span class="mi">10</span> <span class="o">||</span> <span class="nx">c</span><span class="p">.</span><span class="nx">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">?</span> <span class="nx">err</span> <span class="p">:</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">}</span>

<span class="err">@</span><span class="nx">Component</span><span class="p">({</span>
  <span class="p">...</span>
  <span class="na">providers</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span> 
      <span class="na">provide</span><span class="p">:</span> <span class="nx">NG_VALIDATORS</span><span class="p">,</span>
      <span class="na">useValue</span><span class="p">:</span> <span class="nx">validateCounterRange</span><span class="p">,</span>
      <span class="na">multi</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">})</span>
<span class="kr">class</span> <span class="nx">CounterInputComponent</span> <span class="kr">implements</span> <span class="nx">ControlValueAccessor</span> <span class="p">{</span>
  <span class="p">...</span>
<span class="p">}</span></code></pre></div>

<blockquote>
  <blockquote>
    <p><strong>Special Tip:</strong> To make validator functions available to other modules when building reactive forms, it’s good practice to declare them first and reference them in the provider configuration.</p>
  </blockquote>
</blockquote>

<p>Now, the validator can be imported and added to our form model like this:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="p">{</span> <span class="nx">validateCounterRange</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'./counter-input'</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span><span class="p">(...)</span>
<span class="kr">class</span> <span class="nx">AppComponent</span> <span class="kr">implements</span> <span class="nx">OnInit</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="nx">ngOnInit</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">form</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">fb</span><span class="p">.</span><span class="nx">group</span><span class="p">({</span>
      <span class="na">counter</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="nx">validateCounterRange</span><span class="p">]</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>This custom control is getting better and better, but wouldn’t it be <strong>really</strong> cool if the validator was configurable, so that the consumer of the custom form control can decide what the max and min range values are?</p>

<h2 id="making-the-validation-configurable">Making the validation configurable</h2>

<p>Ideally, the consumer of our custom control should be able to do something like this:</p>

<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;counter-input</span>
  <span class="na">formControlName=</span><span class="s">"counter"</span>
  <span class="na">counterRangeMax=</span><span class="s">"10"</span>
  <span class="na">counterRangeMin=</span><span class="s">"0"</span>
  <span class="nt">&gt;&lt;/counter-input&gt;</span></code></pre></div>

<p>Thanks to Angular’s dependency injection and property binding system, this is very easy to implement. Basically what we want to do is to teach our <a href="/angular/2016/03/14/custom-validators-in-angular-2.html#custom-validators-with-dependencies">validator to have dependencies</a>.</p>

<p>Let’s start off by adding the input properties.</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Input</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'@angular/core'</span><span class="p">;</span>
<span class="p">...</span>

<span class="err">@</span><span class="nx">Component</span><span class="p">(...)</span>
<span class="kr">class</span> <span class="nx">CounterInputComponent</span> <span class="kr">implements</span> <span class="nx">ControlValueAccessor</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="err">@</span><span class="nx">Input</span><span class="p">()</span>
  <span class="nx">counterRangeMax</span><span class="p">;</span>

  <span class="err">@</span><span class="nx">Input</span><span class="p">()</span>
  <span class="nx">counterRangeMin</span><span class="p">;</span>
  <span class="p">...</span>
<span class="p">}</span></code></pre></div>

<p>Next, we somehow have to pass these values to our <code>validateCounterRange(c: FormControl)</code>, but per API it only asks for a <code>FormControl</code>. That means we need to create that validator function using a factory that creates a closure like this:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">export</span> <span class="kd">function</span> <span class="nx">createCounterRangeValidator</span><span class="p">(</span><span class="nx">maxValue</span><span class="p">,</span> <span class="nx">minValue</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kd">function</span> <span class="nx">validateCounterRange</span><span class="p">(</span><span class="nx">c</span><span class="err">:</span> <span class="nx">FormControl</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">err</span> <span class="o">=</span> <span class="p">{</span>
      <span class="na">rangeError</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">given</span><span class="p">:</span> <span class="nx">c</span><span class="p">.</span><span class="nx">value</span><span class="p">,</span>
        <span class="na">max</span><span class="p">:</span> <span class="nx">maxValue</span><span class="p">,</span>
        <span class="na">min</span><span class="p">:</span> <span class="nx">minValue</span>
      <span class="p">}</span>
    <span class="p">};</span>

    <span class="k">return</span> <span class="p">(</span><span class="nx">c</span><span class="p">.</span><span class="nx">value</span> <span class="o">&gt;</span> <span class="o">+</span><span class="nx">maxValue</span> <span class="o">||</span> <span class="nx">c</span><span class="p">.</span><span class="nx">value</span> <span class="o">&lt;</span> <span class="o">+</span><span class="nx">minValue</span><span class="p">)</span> <span class="p">?</span> <span class="nx">err</span><span class="p">:</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>Great, we can now create the validator function with the dynamic values we get from the input properties inside our component, and implement a <code>validate()</code> method that Angular will use to perform validation:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Input</span><span class="p">,</span> <span class="nx">OnInit</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'@angular/core'</span><span class="p">;</span>
<span class="p">...</span>

<span class="err">@</span><span class="nx">Component</span><span class="p">(...)</span>
<span class="kr">class</span> <span class="nx">CounterInputComponent</span> <span class="kr">implements</span> <span class="nx">ControlValueAccessor</span><span class="p">,</span> <span class="nx">OnInit</span> <span class="p">{</span>
  <span class="p">...</span>

  <span class="nl">validateFn</span><span class="p">:</span><span class="nb">Function</span><span class="p">;</span>

  <span class="nx">ngOnInit</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">validateFn</span> <span class="o">=</span> <span class="nx">createCounterRangeValidator</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">counterRangeMax</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">counterRangeMin</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nx">validate</span><span class="p">(</span><span class="nx">c</span><span class="err">:</span> <span class="nx">FormControl</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">validateFn</span><span class="p">(</span><span class="nx">c</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>This works but introduces a new problem: <code>validateFn</code> is only set in <code>ngOnInit()</code>. What if <code>counterRangeMax</code> or <code>counterRangeMin</code> change via their bindings? We need to create a new validator function based on these changes. Luckily there’s the <code>ngOnChanges()</code> lifecycle hook that, allows us to do exactly that. All we have to do is to check if there are changes on one of the input properties and recreate our validator function. We can even get rid off <code>ngOnInit()</code> again, because <code>ngOnChanges()</code> is called before <code>ngOnInit()</code> anyways:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="p">{</span> <span class="nx">Input</span><span class="p">,</span> <span class="nx">OnChanges</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'@angular/core'</span><span class="p">;</span>
<span class="p">...</span>

<span class="err">@</span><span class="nx">Component</span><span class="p">(...)</span>
<span class="kr">class</span> <span class="nx">CounterInputComponent</span> <span class="kr">implements</span> <span class="nx">ControlValueAccessor</span><span class="p">,</span> <span class="nx">OnChanges</span> <span class="p">{</span>
  <span class="p">...</span>

  <span class="nl">validateFn</span><span class="p">:</span><span class="nb">Function</span><span class="p">;</span>

  <span class="nx">ngOnChanges</span><span class="p">(</span><span class="nx">changes</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">changes</span><span class="p">.</span><span class="nx">counterRangeMin</span> <span class="o">||</span> <span class="nx">changes</span><span class="p">.</span><span class="nx">counterRangeMax</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">validateFn</span> <span class="o">=</span> <span class="nx">createCounterRangeValidator</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">counterRangeMax</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">counterRangeMin</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="p">...</span>
<span class="p">}</span></code></pre></div>

<p>Last but not least, we need to update the provider for the validator, as it’s now no longer just the function, but the component itself that performs validation:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="err">@</span><span class="nx">Component</span><span class="p">({</span>
  <span class="p">...</span>
  <span class="na">providers</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">...</span>
    <span class="p">{</span> 
      <span class="nl">provide</span><span class="p">:</span> <span class="nx">NG_VALIDATORS</span><span class="p">,</span>
      <span class="na">useExisting</span><span class="p">:</span> <span class="nx">forwardRef</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="nx">CounterInputComponent</span><span class="p">),</span>
      <span class="na">multi</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">})</span>
<span class="kr">class</span> <span class="nx">CounterInputComponent</span> <span class="kr">implements</span> <span class="nx">ControlValueAccessor</span><span class="p">,</span> <span class="nx">OnInit</span> <span class="p">{</span>
  <span class="p">...</span>
<span class="p">}</span></code></pre></div>

<p>Believe it or not, we can now configure the max and min values for our custom form control! If we’re building template-driven forms, it simply looks like this:</p>

<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;counter-input</span>
  <span class="na">ngModel</span>
  <span class="na">name=</span><span class="s">"counter"</span>
  <span class="na">counterRangeMax=</span><span class="s">"10"</span>
  <span class="na">counterRangeMin=</span><span class="s">"0"</span>
  <span class="nt">&gt;&lt;/counter-input&gt;</span></code></pre></div>

<p>This works also with expressions:</p>

<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;counter-input</span>
  <span class="na">ngModel</span>
  <span class="na">name=</span><span class="s">"counter"</span>
  <span class="err">[</span><span class="na">counterRangeMax</span><span class="err">]="</span><span class="na">maxValue</span><span class="err">"</span>
  <span class="err">[</span><span class="na">counterRangeMin</span><span class="err">]="</span><span class="na">minValue</span><span class="err">"</span>
  <span class="nt">&gt;&lt;/counter-input&gt;</span></code></pre></div>

<p>If we’re building model-driven forms, we can simply use the validator factory to add the validator to the form control like this:</p>

<div class="highlight"><pre><code class="language-js" data-lang="js"><span class="kr">import</span> <span class="p">{</span> <span class="nx">createCounterRangeValidator</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">'./counter-input'</span><span class="p">;</span>

<span class="err">@</span><span class="nx">Component</span><span class="p">(...)</span>
<span class="kr">class</span> <span class="nx">AppComponent</span> <span class="kr">implements</span> <span class="nx">OnInit</span> <span class="p">{</span>
  <span class="p">...</span>
  <span class="nx">ngOnInit</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">form</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">fb</span><span class="p">.</span><span class="nx">group</span><span class="p">({</span>
      <span class="na">counter</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="nx">createCounterRangeValidator</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>
    <span class="p">});</span>
  <span class="p">}</span>
<span class="p">}</span></code></pre></div>

<p>Check out the demos below!</p>


          


  <h2 id="demos">Demos</h2>
  
    
    <iframe src="https://embed.plnkr.co/6xVdppNQoLcsXGMf7tph/?deferRun" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>


  



        
          <section class="thtrm-ad thtrm-ad--plain thtrm-ad--border thtrm-ad-transparent thtrm-section thtrm-section--is-promo is-sticky">
<a href="https://course.machinelabs.ai" title="Order now!" id="event-cta" ><img src="/images/ml-course-ad.png"></a>
</section>


        </div>

        <div class="thtrm-subscriber">
  <h3>Get updates on new articles and trainings.</h3>
  <p>Join over 2400 other developers who get our content first.</p>
  <form action="//thoughtram.us8.list-manage.com/subscribe/post?u=dfbb1507fbced5a20d9dc5698&amp;id=731f22cdca" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" target="_blank" novalidate>
    <label for="mce-EMAIL"></label>
    <input type="email" value="" name="EMAIL" placeholder="Your email address..." required>
    <div style="position: absolute; left: -5000px;"><input type="text" name="b_dfbb1507fbced5a20d9dc5698_731f22cdca" tabindex="-1" value=""></div>
    <input type="submit" value="Subscribe" name="subscribe" class="thtrm-cta thtrm-cta--small">
  </form>
  <p class="thtrm-form__info-text">Information on the performance measurement included in the consent, the use of the mail service provider MailChimp and on the logging of the registration and your rights of revocation can be found in our <a href="https://thoughtram.io/imprint.html" title="Privacy Statement">data protection declaration</a>.</p>
</div>



        <div class="thtrm-social-links">
            <!-- Sharingbutton Facebook -->
            <a class="resp-sharing-button__link" href="https://facebook.com/sharer/sharer.php?u=http%3A%2F%2Fblog.thoughtram.io/angular/2016/07/27/custom-form-controls-in-angular-2.html" target="_blank" aria-label="Share on Facebook">
              <div class="resp-sharing-button resp-sharing-button--facebook resp-sharing-button--large"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
                <svg version="1.1" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
                    <g>
                        <path d="M18.768,7.465H14.5V5.56c0-0.896,0.594-1.105,1.012-1.105s2.988,0,2.988,0V0.513L14.171,0.5C10.244,0.5,9.5,3.438,9.5,5.32 v2.145h-3v4h3c0,5.212,0,12,0,12h5c0,0,0-6.85,0-12h3.851L18.768,7.465z"/>
                    </g>
                </svg>
                </div>Share on Facebook</div>
            </a>

            <!-- Sharingbutton Twitter -->
            <a class="resp-sharing-button__link" href="https://twitter.com/intent/tweet/?text=Custom%20Form%20Controls%20in%20Angular&amp;url=http://blog.thoughtram.io/angular/2016/07/27/custom-form-controls-in-angular-2.html" target="_blank" aria-label="Share on Twitter">
              <div class="resp-sharing-button resp-sharing-button--twitter resp-sharing-button--large"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
                <svg version="1.1" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
                    <g>
                        <path d="M23.444,4.834c-0.814,0.363-1.5,0.375-2.228,0.016c0.938-0.562,0.981-0.957,1.32-2.019c-0.878,0.521-1.851,0.9-2.886,1.104 C18.823,3.053,17.642,2.5,16.335,2.5c-2.51,0-4.544,2.036-4.544,4.544c0,0.356,0.04,0.703,0.117,1.036 C8.132,7.891,4.783,6.082,2.542,3.332C2.151,4.003,1.927,4.784,1.927,5.617c0,1.577,0.803,2.967,2.021,3.782 C3.203,9.375,2.503,9.171,1.891,8.831C1.89,8.85,1.89,8.868,1.89,8.888c0,2.202,1.566,4.038,3.646,4.456 c-0.666,0.181-1.368,0.209-2.053,0.079c0.579,1.804,2.257,3.118,4.245,3.155C5.783,18.102,3.372,18.737,1,18.459 C3.012,19.748,5.399,20.5,7.966,20.5c8.358,0,12.928-6.924,12.928-12.929c0-0.198-0.003-0.393-0.012-0.588 C21.769,6.343,22.835,5.746,23.444,4.834z"/>
                    </g>
                </svg>
                </div>Share on Twitter</div>
            </a>

            <!-- Sharingbutton Google+ -->
            <a class="resp-sharing-button__link" href="https://plus.google.com/share?url=http%3A%2F%2Fblog.thoughtram.io/angular/2016/07/27/custom-form-controls-in-angular-2.html" target="_blank" aria-label="Share on Google+">
              <div class="resp-sharing-button resp-sharing-button--google resp-sharing-button--large"><div aria-hidden="true" class="resp-sharing-button__icon resp-sharing-button__icon--solid">
                <svg version="1.1" x="0px" y="0px" width="24px" height="24px" viewBox="0 0 24 24" enable-background="new 0 0 24 24" xml:space="preserve">
                    <g>
                        <path d="M11.366,12.928c-0.729-0.516-1.393-1.273-1.404-1.505c0-0.425,0.038-0.627,0.988-1.368 c1.229-0.962,1.906-2.228,1.906-3.564c0-1.212-0.37-2.289-1.001-3.044h0.488c0.102,0,0.2-0.033,0.282-0.091l1.364-0.989 c0.169-0.121,0.24-0.338,0.176-0.536C14.102,1.635,13.918,1.5,13.709,1.5H7.608c-0.667,0-1.345,0.118-2.011,0.347 c-2.225,0.766-3.778,2.66-3.778,4.605c0,2.755,2.134,4.845,4.987,4.91c-0.056,0.22-0.084,0.434-0.084,0.645 c0,0.425,0.108,0.827,0.33,1.216c-0.026,0-0.051,0-0.079,0c-2.72,0-5.175,1.334-6.107,3.32C0.623,17.06,0.5,17.582,0.5,18.098 c0,0.501,0.129,0.984,0.382,1.438c0.585,1.046,1.843,1.861,3.544,2.289c0.877,0.223,1.82,0.335,2.8,0.335 c0.88,0,1.718-0.114,2.494-0.338c2.419-0.702,3.981-2.482,3.981-4.538C13.701,15.312,13.068,14.132,11.366,12.928z M3.66,17.443 c0-1.435,1.823-2.693,3.899-2.693h0.057c0.451,0.005,0.892,0.072,1.309,0.2c0.142,0.098,0.28,0.192,0.412,0.282 c0.962,0.656,1.597,1.088,1.774,1.783c0.041,0.175,0.063,0.35,0.063,0.519c0,1.787-1.333,2.693-3.961,2.693 C5.221,20.225,3.66,19.002,3.66,17.443z M5.551,3.89c0.324-0.371,0.75-0.566,1.227-0.566l0.055,0 c1.349,0.041,2.639,1.543,2.876,3.349c0.133,1.013-0.092,1.964-0.601,2.544C8.782,9.589,8.363,9.783,7.866,9.783H7.865H7.844 c-1.321-0.04-2.639-1.6-2.875-3.405C4.836,5.37,5.049,4.462,5.551,3.89z"/>
                        <polygon points="23.5,9.5 20.5,9.5 20.5,6.5 18.5,6.5 18.5,9.5 15.5,9.5 15.5,11.5 18.5,11.5 18.5,14.5 20.5,14.5 20.5,11.5  23.5,11.5   "/>
                    </g>
                </svg>
                </div>Share on Google+</div>
            </a>
        </div>

        <h3 class="thtrm-section-headline thtrm-section-headline--with-margin">Author</h3>
        <div class="thtrm-article-author">
          <span class="thtrm-article-author-avatar"><img src="/images/author-pascal.jpg" alt="Picture of Pascal Precht"></span>
          <div class="thtrm-article-author-matter">
            <h4 class="thtrm-article-author-name">Pascal Precht</h4>
            <p class="thtrm-article-author-text">Pascal is a front-end engineer and a Angular Developer Expert nominated by Google. He created the angular-translate module, is an Angular contributor and also part of the Angular Docs Authoring team.</p>
            <p>
              <a class="thtrm-article-author-cta thtrm-article-author-cta-twitter" href="http://twitter.com/PascalPrecht" title="Pascal Precht on Twitter">Twitter</a>
              <a class="thtrm-article-author-cta" href="http://github.com/PascalPrecht" title="Pascal Precht on GitHub">GitHub</a>
            </p>
          </div>
        </div>
      </div>

      <div class="thtrm-constraint">

        
        <h4 class="thtrm-section-headline thtrm-section-headline--with-big-margin thtrm-section-headline--centered">Related Posts</h4>
        <ul class="thtrm-three-column-list thtrm-three-column-list--with-padding">
        
        
          
          <li>
            <a class="thtrm-article-card" href="/angularjs/2015/01/11/exploring-angular-1.3-validators-pipeline.html" title="Validators Pipeline in Angular 1.3">
              <div class="thtrm-article-card-image" style="background-image: linear-gradient(to bottom, rgba(0,0,0,0) 0%,rgba(0,0,0,0.01) 2%,#29383E 100%),url(/images/banner/fallback.jpeg);"></div>
              <div class="thtrm-article-card-content ">
                <h3>Validators Pipeline in Angular 1.3</h3>
                <p>In this article we discuss a newly introduced feature called custom validators, so we don't have to hijack parsers and...</p>
              </div>
            </a>
          </li>
        
          
          <li>
            <a class="thtrm-article-card" href="/angular/2016/10/13/two-way-data-binding-in-angular-2.html" title="Two-way Data Binding in Angular">
              <div class="thtrm-article-card-image" style="background-image: linear-gradient(to bottom, rgba(0,0,0,0) 0%,rgba(0,0,0,0.01) 2%,#29383E 100%),url(/images/banner/two-way-data-binding-in-angular-2.jpg);"></div>
              <div class="thtrm-article-card-content ">
                <h3>Two-way Data Binding in Angular</h3>
                <p>Two-way data binding was one of the main selling points of AngularJS. Since Angular, we can build directives that implement...</p>
              </div>
            </a>
          </li>
        
          
          <li>
            <a class="thtrm-article-card" href="/angular/2016/06/22/model-driven-forms-in-angular-2.html" title="Reactive Forms in Angular">
              <div class="thtrm-article-card-image" style="background-image: linear-gradient(to bottom, rgba(0,0,0,0) 0%,rgba(0,0,0,0.01) 2%,#29383E 100%),url(/images/banner/model-driven-forms-in-angular-2.jpeg);"></div>
              <div class="thtrm-article-card-content ">
                <h3>Reactive Forms in Angular</h3>
                <p>Angular allows us to build forms in a model-driven fashion. In this article we're going to discuss what that looks...</p>
              </div>
            </a>
          </li>
        
          
          <li>
            <a class="thtrm-article-card" href="/angular/2016/03/21/template-driven-forms-in-angular-2.html" title="Template-driven Forms in Angular">
              <div class="thtrm-article-card-image" style="background-image: linear-gradient(to bottom, rgba(0,0,0,0) 0%,rgba(0,0,0,0.01) 2%,#29383E 100%),url(/images/template-driven-forms.jpeg);"></div>
              <div class="thtrm-article-card-content ">
                <h3>Template-driven Forms in Angular</h3>
                <p>In this article we discuss the template-driven forms in Angular and all the directives that come into play.</p>
              </div>
            </a>
          </li>
        
          
          <li>
            <a class="thtrm-article-card" href="/angular/2016/03/14/custom-validators-in-angular-2.html" title="Custom Validators in Angular">
              <div class="thtrm-article-card-image" style="background-image: linear-gradient(to bottom, rgba(0,0,0,0) 0%,rgba(0,0,0,0.01) 2%,#29383E 100%),url(/images/custom-validators-bg.jpeg);"></div>
              <div class="thtrm-article-card-content ">
                <h3>Custom Validators in Angular</h3>
                <p>Often, we need to add custom validation capabilities to our application's form. In this article we're going to explore how...</p>
              </div>
            </a>
          </li>
        
          
          <li>
            <a class="thtrm-article-card" href="/angular/2018/03/05/advanced-caching-with-rxjs.html" title="Advanced caching with RxJS">
              <div class="thtrm-article-card-image" style="background-image: linear-gradient(to bottom, rgba(0,0,0,0) 0%,rgba(0,0,0,0.01) 2%,#29383E 100%),url(/images/banner/advanced_caching.jpg);"></div>
              <div class="thtrm-article-card-content ">
                <h3>Advanced caching with RxJS</h3>
                <p>When building web applications, performance should always be a top priority. One very efficient way to optimize the performance of...</p>
              </div>
            </a>
          </li>
        
        
        </ul>
        

      

      </div>
    </main>
    <footer role="contentinfo" class="thtrm-footer thtrm-footer--slim">
  <div class="thtrm-footer-text">
    <img class="thtrm-footer-logo" alt="thoughtram brain" src="/images/thoughtram-brain-white.png">
    <p>This website was created in collaboration with <a href="http://twitter.com/timche_" title="Tim Cheung on Twitter"><strong>Tim Cheung</strong></a> and <a href="http://twitter.com/tim_hartmann_" title="Tim Hartmann on Twitter"><strong>Tim Hartmann</strong></a>.</p>
    <p ><a href="http://thoughtram.io/code-of-conduct.html" title="Code of Conduct">Code of Conduct</a> &bullet; <a href="http://thoughtram.io/imprint.html" title="Legal Notice">Legal notice</a></p>
    <p class="thtrm-footer-bottom">&copy; 2014-2017 thoughtram GmbH</p>
  </div>
</footer>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-51360648-2', 'auto');
ga('send', 'pageview');

var form = document.getElementById('search-form');
var eventCta = document.getElementById('event-cta');

if (eventCta) {

  eventCta.addEventListener('click', function (event) {
    event.preventDefault();

    setTimeout(clickLink, 1000);

    function clickLink() {
      window.location.replace(eventCta.getAttribute('href'));
    }

    ga('send', 'event', {
      eventCategory: 'Event Link',
      eventAction: 'click',
      eventLabel: eventCta.getAttribute('title'),
      hitCallback: clickLink
    });
  });
}

if (form) {

  var searchTerm = document.getElementById('search-term');

  form.addEventListener('submit', function(event) {
    event.preventDefault();

    var formSubmitted = false;

    setTimeout(submitForm, 1000);

    function submitForm() {
      if (!formSubmitted) {
        formSubmitted = true;
        form.submit();
      }
    }

    ga('send', 'event', {
      eventCategory: 'Search Form',
      eventAction: 'submit',
      eventLabel: searchTerm.value,
      hitCallback: submitForm
    });
  });
}
</script>



    <script src="/scripts/linkjuice/dist/linkjuice.js"></script>
    <script src="/scripts/main.js"></script>
  </body>
</html>
